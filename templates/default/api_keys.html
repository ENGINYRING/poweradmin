<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.php">{% trans %}Home{% endtrans %}</a></li>
        <li class="breadcrumb-item" aria-current="page">{% trans %}API Keys{% endtrans %}</li>
    </ol>
</nav>

<div class="card shadow-sm mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <strong><i class="bi bi-key-fill me-2"></i>{% trans %}API Keys Management{% endtrans %}</strong>
        {% if can_add_more %}
        <a class="btn btn-primary btn-sm" href="index.php?page=api_keys&amp;action=add">
            <i class="bi bi-plus-circle me-1 text-white"></i>{% trans %}Add new API key{% endtrans %}
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        <p>{% trans %}API keys allow external applications to access the Poweradmin API. Each key is linked to your user account and inherits your permissions.{% endtrans %}</p>
        
        {% if not can_add_more %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {% trans %}You have reached the maximum number of API keys allowed.{% endtrans %} ({{ max_keys_per_user }})
        </div>
        {% endif %}
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            {% if api_keys|length > 0 %}
            <table class="table table-striped table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>{% trans %}Name{% endtrans %}</th>
                        <th>{% trans %}Status{% endtrans %}</th>
                        <th>{% trans %}Created at{% endtrans %}</th>
                        <th>{% trans %}Last used{% endtrans %}</th>
                        <th>{% trans %}Expires at{% endtrans %}</th>
                        <th class="text-end">{% trans %}Actions{% endtrans %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for key in api_keys %}
                    <tr class="{% if key.isDisabled or key.hasExpired %}table-secondary{% endif %}">
                        <td>
                            <strong>{{ key.name }}</strong>
                        </td>
                        <td>
                            {% if key.isDisabled %}
                                <span class="badge bg-danger">{% trans %}Disabled{% endtrans %}</span>
                            {% elseif key.hasExpired %}
                                <span class="badge bg-danger">{% trans %}Expired{% endtrans %}</span>
                            {% else %}
                                <span class="badge bg-success">{% trans %}Active{% endtrans %}</span>
                            {% endif %}
                        </td>
                        <td>{{ key.createdAt|date('Y-m-d H:i') }}</td>
                        <td>{% if key.lastUsedAt %}{{ key.lastUsedAt|date('Y-m-d H:i') }}{% else %}<span class="text-muted">{% trans %}Never{% endtrans %}</span>{% endif %}</td>
                        <td>{% if key.expiresAt %}{{ key.expiresAt|date('Y-m-d H:i') }}{% else %}<span class="text-muted">{% trans %}Never{% endtrans %}</span>{% endif %}</td>
                        <td class="text-end">
                            <div class="gap-2">
                                <a class="btn btn-sm btn-outline-primary" href="index.php?page=api_keys&amp;action=edit&amp;id={{ key.id }}" title="{% trans %}Edit{% endtrans %}">
                                    <i class="bi bi-pencil-square text-primary"></i> <span class="d-none d-md-inline text-primary">{% trans %}Edit{% endtrans %}</span>
                                </a>
                                <a class="btn btn-sm btn-outline-secondary" href="index.php?page=api_keys&amp;action=regenerate&amp;id={{ key.id }}" title="{% trans %}Regenerate{% endtrans %}">
                                    <i class="bi bi-arrow-repeat text-secondary"></i> <span class="d-none d-md-inline text-secondary">{% trans %}Regenerate{% endtrans %}</span>
                                </a>
                                {% if key.isDisabled %}
                                    <a class="btn btn-sm btn-outline-success" href="index.php?page=api_keys&amp;action=toggle&amp;id={{ key.id }}&amp;disable=0" title="{% trans %}Enable{% endtrans %}">
                                        <i class="bi bi-check-circle text-success"></i> <span class="d-none d-md-inline text-success">{% trans %}Enable{% endtrans %}</span>
                                    </a>
                                {% else %}
                                    <a class="btn btn-sm btn-outline-secondary" href="index.php?page=api_keys&amp;action=toggle&amp;id={{ key.id }}&amp;disable=1" title="{% trans %}Disable{% endtrans %}">
                                        <i class="bi bi-slash-circle text-secondary"></i> <span class="d-none d-md-inline text-secondary">{% trans %}Disable{% endtrans %}</span>
                                    </a>
                                {% endif %}
                                <a class="btn btn-sm btn-outline-danger" href="index.php?page=api_keys&amp;action=delete&amp;id={{ key.id }}" title="{% trans %}Delete{% endtrans %}">
                                    <i class="bi bi-trash text-danger"></i> <span class="d-none d-md-inline text-danger">{% trans %}Delete{% endtrans %}</span>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="text-center py-4">
                <i class="bi bi-key text-muted mb-3" style="font-size: 2rem;"></i>
                <p class="mb-0">{% trans %}No API keys found.{% endtrans %}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% if api_keys|length > 0 and can_add_more %}
    <div class="card-footer py-3">
        <a class="btn btn-primary btn-sm" href="index.php?page=api_keys&amp;action=add">
            <i class="bi bi-plus-circle me-1 text-white"></i>{% trans %}Add new API key{% endtrans %}
        </a>
    </div>
    {% endif %}
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header py-3">
        <strong><i class="bi bi-book me-2"></i>{% trans %}API Documentation{% endtrans %}</strong>
    </div>
    <div class="card-body">
        <h5>{% trans %}API Authentication{% endtrans %}</h5>
        <p>{% trans %}Poweradmin API supports multiple authentication methods for different API routes:{% endtrans %}</p>

        <div class="mb-4">
            <div class="list-group mb-3">
                <div class="list-group-item">
                    <strong>{% trans %}Public API routes (api/v1/*){% endtrans %}</strong>
                    <div class="small text-muted">{% trans %}Support both API key and HTTP Basic Authentication{% endtrans %}</div>
                </div>
                <div class="list-group-item">
                    <strong>{% trans %}Internal API routes (api/internal/*){% endtrans %}</strong>
                    <div class="small text-muted">{% trans %}Support only session-based authentication{% endtrans %}</div>
                </div>
            </div>
        </div>

        <h5>{% trans %}API Key Authentication{% endtrans %}</h5>
        <p>{% trans %}To use an API key, include it in one of these HTTP request headers:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-2 font-monospace small">X-API-Key: your-api-key-here</div>
        <p class="text-center my-1">{% trans %}OR{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-4 font-monospace small">Authorization: Bearer your-api-key-here</div>

        <h5>{% trans %}HTTP Basic Authentication{% endtrans %}</h5>
        <p>{% trans %}For basic authentication, provide your Poweradmin username and password:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-2 font-monospace small">Authorization: Basic base64(username:password)</div>
        <p>{% trans %}Example curl command:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-4 font-monospace small">curl -u username:password https://your-server.com/index.php?page=api/v1/auth_test</div>

        <h5>{% trans %}Testing Authentication{% endtrans %}</h5>
        <p>{% trans %}To test your authentication credentials, make a request to the auth test endpoint:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-2 font-monospace small">GET /index.php?page=api/v1/auth_test</div>
        <p>{% trans %}Example curl commands:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-3 font-monospace small"># API Key Authentication
curl -H "X-API-Key: your-api-key-here" https://your-server.com/index.php?page=api/v1/auth_test

# HTTP Basic Authentication
curl -u username:password https://your-server.com/index.php?page=api/v1/auth_test</div>
        <p>{% trans %}A successful response will show your authentication details:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-4 font-monospace small">{
  "authenticated": true,
  "user_id": 123,
  "username": "admin",
  "auth_method": "api_key", // or "sql" or "ldap"
  "is_admin": true,
  "permissions": ["user_is_ueberuser", "zone_content_view_own", ...],
  "server_time": "2025-05-08 08:45:23"
}</div>

        <h5>{% trans %}Key Validation Endpoint{% endtrans %}</h5>
        <p>{% trans %}You can also use the dedicated key validation endpoint:{% endtrans %}</p>
        <div class="bg-light p-2 border rounded mb-4 font-monospace small">GET /index.php?page=api/v1/key_validation</div>

        <h5>{% trans %}Security Notes:{% endtrans %}</h5>
        <div class="alert alert-info">
            <ul class="mb-0">
                <li>{% trans %}Keep your API keys secure and never share them publicly.{% endtrans %}</li>
                <li>{% trans %}Always use HTTPS for API requests to protect credentials in transit.{% endtrans %}</li>
                <li>{% trans %}Regenerate your key if you suspect it has been compromised.{% endtrans %}</li>
                <li>{% trans %}Set an expiration date for keys that have temporary access.{% endtrans %}</li>
                <li>{% trans %}Disable keys that are not currently in use.{% endtrans %}</li>
                <li>{% trans %}HTTP Basic Authentication is more suitable for trusted client applications.{% endtrans %}</li>
            </ul>
        </div>
    </div>
</div>